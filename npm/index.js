"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const sto=setTimeout,isFunc=e=>"function"==typeof e;function filteredArray(e,t){const r=Object.assign([],e);let n=0;for(var o=t.length;n<o;){var c=r.indexOf(t[n]);0<=c&&r.splice(c,1),n++}return r}function escHTML(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function styleToString(r){return Object.keys(r).reduce((e,t)=>e+t.split(/(?=[A-Z])/).join("-").toLowerCase()+":"+r[t]+";","")}function removeAttributes(e,c){return("string"==typeof e?e:e()).replace(/ c-.*="\d+"/g,e=>{var t=(e||"").split(" ");let r="";for(let e=0;e<t.length;e++){var n,o=c[t[e]];o&&({key:o,value:n}=o,"object"==typeof n&&"ref"!==o&&(r+=` ${o}="${styleToString(n)}"`),!0===n&&(r+=" "+o))}return r})}function hasChange(r,e){return!r||r.length!==e.length||e.some((e,t)=>e!==r[t])}function runCleanup(e){isFunc(e.clean)&&e.clean()}function invoveEffect(e,t){"boolean"!=typeof t&&(runCleanup(e),e.clean=void 0),isFunc(e.val)&&sto(()=>e.clean=e.val())}function cleanEffect(e){e.hook&&sto(()=>e.hook.s.forEach(runCleanup))}function runEffectFromStates(e,t){if(e.length){const r=e.filter(e=>!0===e.status),n=e.filter(e=>!1===e.status);r.length&&sto(()=>r.forEach(e=>invoveEffect(e,t))),n.length&&n.forEach(e=>invoveEffect(e,t))}}const isVanicAttr=e=>"c"===e[0]&&"-"===e[1];function isNotMatch(e,t){return e.nodeType!==t.nodeType||e.tagName!==t.tagName||e.id!==t.id||e.src!==t.src||getAttr(e,"c-comp")!==getAttr(t,"c-comp")}function getAttr(e,t){return e.getAttribute?e.getAttribute(t):""}function getNodeContent(e,t){return t?"href"===t||isVanicAttr(t)||"string"!=typeof e[t]?getAttr(e,t):e[t]:e.childNodes&&0<e.childNodes.length?null:e.textContent}function diff(e,s){const i=Array.prototype.slice.call(s.childNodes),t=Array.prototype.slice.call(e.childNodes);let r=i.length-t.length;if(0<r)for(;0<r;r--)i[i.length-r].parentNode.removeChild(i[i.length-r]);t.forEach(function(t,r){if(!i[r])return e=t.cloneNode(!0),void s.appendChild(e);if(t.attributes&&t.attributes.length){let e=0;for(var n=t.attributes.length;e<n;){var o=t.attributes[e];if(o.name){var c=getNodeContent(t,o.name)||"";if(c!==(getNodeContent(i[r],o.name)||"")){let e=o.name;isVanicAttr(e)?"c-comp"!==e&&i[r].setAttribute&&i[r].setAttribute(e,c):("class"===e?e="className":"for"===e&&(e="htmlFor"),i[r][e]=c)}}e++}}if(isNotMatch(t,i[r]))i[r].parentNode.replaceChild(t.cloneNode(!0),i[r]);else{var e=getNodeContent(t);if(e&&e!==getNodeContent(i[r])&&(i[r].textContent=e),!(0<i[r].childNodes.length&&t.childNodes.length<1))return i[r].childNodes.length<1&&0<t.childNodes.length?(diff(t,e=document.createDocumentFragment()),void i[r].appendChild(e)):void(0<t.childNodes.length&&diff(t,i[r]));i[r].innerHTML=""}})}let reRender,reElem,fno=[],rep={},idx=0,hid=0,curComp,primIndex=0,lastRes;const primObject={},dangerHTML="dangerouslySetInnerHTML";function _render(e){var t=e();const r=document.createElement("div");r.innerHTML=t,diff(r,reElem);let n=fno.length;for(;n--;){const l=fno[n];var o=l.value,c=l.key.toLowerCase();if("ref"!==c){const a=reElem.querySelector(`[c-${c}="${n}"]`);if(a)if("object"==typeof o)for(const u in o)a[c][u]=o[u];else a[c]=o}}idx=0,fno=[];var s,i=reElem.querySelectorAll("[c-comp]");reRender&&i.length!==primIndex&&(i=Array.prototype.map.call(i,e=>e.getAttribute&&e.getAttribute("c-comp")),filteredArray(s=lastRes.match(/(?<=c-comp=")(.*?)(?=")/gm)||[],i).forEach(e=>{e=primObject[e];e&&cleanEffect(e)}),filteredArray(i,s).forEach(e=>{e=primObject[e];if(e){const t=e["hook"];t.y.splice(0),t.e.splice(0),runEffectFromStates(t.s,!0)}}),primIndex=i.length),lastRes=t,reRender=e}function html(e){const a=[].slice.call(arguments,1);return e.reduce((e,t,r)=>{let n=a[r-1];null!==n&&void 0!==n||(n="");r=typeof(n=Array.isArray(n)?n.join(""):n);if("function"==r||"boolean"==r||"object"==r){const i=e.match(/[^ ]+/g);var o=n,c=(i[i.length-1]||"").replace(/=|"/g,"").toLowerCase();if(!/<|>/.test(c)){var s=idx++;const l=`c-${c}="`+s;"ref"===c&&(n.ref=()=>document.querySelector(`[${l}"]`)),fno[s]={key:c,value:o},"function"!=r&&(rep[l+'"']={key:c,value:o}),e=i.slice(0,-1).join(" ")+(" "+l)}n=""}return e+String(n)+t})}function renderToString(e){return removeAttributes(e,rep)}function render(e,t){reRender=void 0,lastRes=void 0,fno=[],rep={},idx=0,reElem=t,_render(e)}const comp=n=>{const o=s.hook={i:0,e:[],y:[],s:[]},c=hid++;function s(e){var t=curComp;curComp=s,o.i=0;let r=n(void 0===e?{}:e);return"string"==typeof r&&(r=(r=/<.*>/.test(r)?r:`<notag>${r}</notag>`).replace(/>/,` c-comp="${c}">`),primObject[""+c]=curComp,reRender||primIndex++),t&&(curComp=t),reRender?(o.e.length&&sto(()=>o.e.splice(0).forEach(invoveEffect)),o.y.length&&o.y.splice(0).forEach(invoveEffect)):runEffectFromStates(o.s),r}return s},buildEffect=i=>(e,t)=>{if(reElem){const{i:n,s:o,e:c,y:s}=curComp.hook;t=t||o.map(e=>e.state).filter(Boolean);var r=n>=o.length;r&&(o[n]={deps:t,val:e,status:i}),reRender&&(r||hasChange(o[n].deps,t))&&(i?c:s).push(o[n]),o[n].val=e,o[n].deps=t,o[n].status=i,curComp.hook.i++}};function useState(e){const{s:t,i:r}=curComp.hook,n=void 0===t[r]?e:t[r].state;return r>=t.length&&t.push({state:n}),curComp.hook.i++,[n,e=>{t[r].state=isFunc(e)?e(n):e,_render(reRender)},()=>t[r].state]}const useEffect=buildEffect(!0),useLayoutEffect=buildEffect(!1);function useReducer(t,e,r){const n=useState(void 0!==r?r(e):e);return[n[0],e=>{n[1](t(n[0],e))}]}function useMemo(e,t){if(!reElem)return e();const{i:r,s:n}=curComp.hook;return t=t||n.map(e=>e.state).filter(Boolean),(r>=n.length||hasChange(n[r].deps,t))&&(n[r]={val:e(),deps:t}),curComp.hook.i++,n[r].val}const useCallback=(e,t)=>useMemo(()=>e,t),useRef=e=>useMemo(()=>({current:e,ref:()=>e}),[]),createContext=r=>{let n;return{Provider(e,t){return n=e||r,t()},v:()=>n}},useContext=e=>e.v();function h(e,t){var r=[].slice.call(arguments,2);const n=[];let o="";t=t||{};for(let e=r.length;e--;)n.push("number"==typeof r[e]?String(r[e]):r[e]);if(isFunc(e))return t.children=n.reverse(),e(t);if(e){if(o+="<"+e,t)for(var c in t)if("children"!==c){let e=t[c];var s=typeof e;if("function"==s||"boolean"==s||"object"==s){var i=e,l=c.toLowerCase();const u=idx++;"ref"===l&&(e.ref=()=>document.querySelector(`[c-${u}="${u}"]`)),fno[u]={key:l,value:i},c="c-"+l,e=u,"function"!=s&&(rep[`${c}="${e}"`]={key:l,value:i})}void 0!==e&&!1!==e&&null!==e&&c!==dangerHTML&&(o+=` ${c}="${escHTML(e)}"`)}o+=">"}if(-1===["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(e)){if(t[dangerHTML])o+=t[dangerHTML].__html;else for(let e=n.length;e--;){var a=Array.isArray(n[e])?n[e].join(""):n[e];"string"==typeof a&&(o+="<"!==a[0]?escHTML(a):a)}o+=e?`</${e}>`:""}return o}const Fragment=({children:e})=>h(null,null,e);exports.Fragment=Fragment,exports.comp=comp,exports.createContext=createContext,exports.h=h,exports.html=html,exports.render=render,exports.renderToString=renderToString,exports.useCallback=useCallback,exports.useContext=useContext,exports.useEffect=useEffect,exports.useLayoutEffect=useLayoutEffect,exports.useMemo=useMemo,exports.useReducer=useReducer,exports.useRef=useRef,exports.useState=useState;
