"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const sto=setTimeout,isFunc=e=>"function"==typeof e;function filteredArray(e,t){const r=Object.assign([],e);let n=0;for(var o=t.length;n<o;){var c=r.indexOf(t[n]);0<=c&&r.splice(c,1),n++}return r}function escHTML(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function styleToString(r){return Object.keys(r).reduce((e,t)=>e+t.split(/(?=[A-Z])/).join("-").toLowerCase()+":"+r[t]+";","")}function removeAttributes(e,c){return("string"==typeof e?e:e()).replace(/ c-.*="\d+"/g,e=>{var t=(e||"").split(" ");let r="";for(let e=0;e<t.length;e++){var n,o=c[t[e]];o&&({key:o,value:n}=o,"object"==typeof n&&"ref"!==o&&(r+=` ${o}="${styleToString(n)}"`),!0===n&&(r+=" "+o))}return r})}function hasChange(r,e){return!r||e.some((e,t)=>e!==r[t])}function runCleanup(e){isFunc(e.c)&&e.c()}function findParent(e){if("BODY"===e.tagName||!e.parentNode)return null;const t=e.parentNode;if(t&&t.getAttribute){e=t.getAttribute("c-comp");if(e)return e}return findParent(t)}function invoveEffect(e,t,r,n){var o=!e._d||hasChange(e.d,e._d);e._d=e.d,(n||t||o)&&(t||(runCleanup(e),e.c=void 0),isFunc(e.v)&&(r?sto(()=>e.c=e.v()):e.c=e.v()))}function cleanEffect(e){e.hook&&sto(()=>e.hook.s.forEach(runCleanup))}function runEffectFromStates(e,t,r,n){var o=e.s,c=o.length;let i=0;if(c){const s=[],u=[],a=e=>invoveEffect(e,t,r,n);for(;i<c;){var l=o[i];!0===l.s?s.push(l):!1===l.s&&u.push(l),i++}s.length&&sto(()=>s.forEach(a)),u.forEach(a)}}const isVanicAttr=e=>"c"===e[0]&&"-"===e[1];function isNotMatch(e,t){return e.nodeType!==t.nodeType||e.tagName!==t.tagName||e.id!==t.id||e.src!==t.src||getAttr(e,"c-comp")!==getAttr(t,"c-comp")}function getAttr(e,t){return e.getAttribute?e.getAttribute(t):""}function getNodeContent(e,t){return t?"href"===t||isVanicAttr(t)||"string"!=typeof e[t]?getAttr(e,t):e[t]:e.childNodes&&0<e.childNodes.length?null:e.textContent}function diff(e,i){const l=Array.prototype.slice.call(i.childNodes),t=Array.prototype.slice.call(e.childNodes);let r=l.length-t.length;if(0<r)for(;0<r;r--)l[l.length-r].parentNode.removeChild(l[l.length-r]);t.forEach(function(t,r){if(!l[r])return e=t.cloneNode(!0),void i.appendChild(e);if(t.attributes&&t.attributes.length){let e=0;for(var n=t.attributes.length;e<n;){var o=t.attributes[e];if(o.name){var c=getNodeContent(t,o.name)||"";if(c!==(getNodeContent(l[r],o.name)||"")){let e=o.name;isVanicAttr(e)?"c-comp"!==e&&l[r].setAttribute&&l[r].setAttribute(e,c):("class"===e?e="className":"for"===e&&(e="htmlFor"),l[r][e]=c)}}e++}}if(isNotMatch(t,l[r]))l[r].parentNode.replaceChild(t.cloneNode(!0),l[r]);else{var e=getNodeContent(t);if(e&&e!==getNodeContent(l[r])&&(l[r].textContent=e),!(0<l[r].childNodes.length&&t.childNodes.length<1))return l[r].childNodes.length<1&&0<t.childNodes.length?(diff(t,e=document.createDocumentFragment()),void l[r].appendChild(e)):void(0<t.childNodes.length&&diff(t,l[r]));l[r].innerHTML=""}})}let reRender,reElem,fno=[],rep={},idx=0,hid=0,curComp,primIndex=0,lastRes;const primObject={},dangerHTML="dangerouslySetInnerHTML",mapElem=Array.prototype.map;function _render(e,t){var r=e();const n=document.createElement("div");n.innerHTML=r,diff(n,reElem);let o=fno.length;for(;o--;){const a=fno[o];var c=a.value,i=a.key.toLowerCase();if("ref"!==i){const f=reElem.querySelector(`[c-${i}="${o}"]`);if(f)if("object"==typeof c)for(const d in c)f[i][d]=c[d];else f[i]=c}}idx=0,fno=[];var l=reElem.querySelectorAll("[c-comp]");let s=[];if(reRender&&l.length!==primIndex&&(l=mapElem.call(l,e=>e.getAttribute&&e.getAttribute("c-comp")),filteredArray(u=lastRes.match(/(?<=c-comp=")(.*?)(?=")/gm)||[],l).forEach(e=>{e=primObject[e];e&&cleanEffect(e)}),(s=filteredArray(l,u)).forEach(e=>{e=primObject[e];e&&runEffectFromStates(e.hook,!0,!0)}),primIndex=l.length),lastRes=r,t){const n=reElem.querySelector(`[c-comp="${t}"]`);var u=n.querySelectorAll("[c-comp]")||[];let e=mapElem.call(u,e=>findParent(e)===t?e.getAttribute&&e.getAttribute("c-comp"):null).concat([t]).filter(Boolean);(e=s.length?filteredArray(e,s):e).forEach(e=>{e=primObject[e];e&&runEffectFromStates(e.hook)})}reRender=e}function html(e){const u=[].slice.call(arguments,1);return e.reduce((e,t,r)=>{let n=u[r-1];null!==n&&void 0!==n||(n="");r=typeof(n=Array.isArray(n)?n.join(""):n);if("function"==r||"boolean"==r||"object"==r){const l=e.match(/[^ ]+/g);var o=n,c=(l[l.length-1]||"").replace(/=|"/g,"").toLowerCase(),i=idx++;const s=`c-${c}="`+i;"ref"===c&&(n.ref=()=>reElem.querySelector(`[${s}"]`)),fno[i]={key:c,value:o},"function"!=r&&(rep[s+'"']={key:c,value:o}),e=l.slice(0,-1).join(" ")+(" "+s),n=""}return e+String(n)+t})}function renderToString(e){return removeAttributes(e,rep)}function render(e,t){reRender=void 0,lastRes=void 0,fno=[],rep={},idx=0,reElem=t,_render(e)}const comp=n=>{const o=hid++,c=i.hook={i:0,s:[],c:""+o};function i(e){var t=curComp;curComp=i,c.i=0;let r=n(void 0===e?{}:e);return"string"==typeof r&&(r=(r=/<.*>/.test(r)?r:`<notag>${r}</notag>`).replace(/>/,` c-comp="${o}">`),primObject[""+o]=curComp,reRender||primIndex++),t&&(curComp=t),reRender||runEffectFromStates(c,void 0,!0,!0),r}return i},buildEffect=o=>(e,t)=>{if(reElem){const{i:r,s:n}=curComp.hook;r>=n.length&&(n[r]={d:t,v:e,s:o}),n[r].v=e,n[r].d=t,n[r].s=o,curComp.hook.i++}};function useState(e){const{s:t,i:r,c:n}=curComp.hook,o=void 0===t[r]?e:t[r].st;return r>=t.length&&t.push({st:o}),curComp.hook.i++,[o,e=>{t[r].st=isFunc(e)?e(o):e,_render(reRender,n)},()=>t[r].st]}const useEffect=buildEffect(!0),useLayoutEffect=buildEffect(!1);function useReducer(t,e,r){const n=useState(void 0!==r?r(e):e);return[n[0],e=>{n[1](t(n[0],e))}]}function useMemo(e,t){if(!reElem)return e();const{i:r,s:n}=curComp.hook;return(r>=n.length||hasChange(n[r].d,t))&&(n[r]={v:e(),d:t}),curComp.hook.i++,n[r].v}const useCallback=(e,t)=>useMemo(()=>e,t),useRef=e=>useMemo(()=>({current:e,ref:()=>e}),[]),createContext=r=>{let n;return{Provider(e,t){return n=e||r,t()},v:()=>n}},useContext=e=>e.v();function h(e,t){var r=[].slice.call(arguments,2);const n=[];let o="";t=t||{};for(let e=r.length;e--;)n.push("number"==typeof r[e]?String(r[e]):r[e]);if(isFunc(e))return t.children=n.reverse(),e(t);if(e){if(o+="<"+e,t)for(var c in t)if("children"!==c){let e=t[c];var i=typeof e;if("function"==i||"boolean"==i||"object"==i){var l=e;const u=c.toLowerCase(),a=idx++;"ref"===u&&(e.ref=()=>reElem.querySelector(`[c-${u}="${a}"]`)),fno[a]={key:u,value:l},c="c-"+u,e=a,"function"!=i&&(rep[`${c}="${e}"`]={key:u,value:l})}void 0!==e&&!1!==e&&null!==e&&c!==dangerHTML&&(o+=` ${c}="${escHTML(e)}"`)}o+=">"}if(-1===["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(e)){if(t[dangerHTML])o+=t[dangerHTML].__html;else for(let e=n.length;e--;){var s=Array.isArray(n[e])?n[e].join(""):n[e];"string"==typeof s&&(o+="<"!==s[0]?escHTML(s):s)}o+=e?`</${e}>`:""}return o}const Fragment=({children:e})=>h(null,null,e);exports.Fragment=Fragment,exports.comp=comp,exports.createContext=createContext,exports.h=h,exports.html=html,exports.render=render,exports.renderToString=renderToString,exports.useCallback=useCallback,exports.useContext=useContext,exports.useEffect=useEffect,exports.useLayoutEffect=useLayoutEffect,exports.useMemo=useMemo,exports.useReducer=useReducer,exports.useRef=useRef,exports.useState=useState;
