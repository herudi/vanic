const isVanicAttr=e=>"c"===e[0]&&"-"===e[1];function isNotMatch(e,t){return e.nodeType!==t.nodeType||e.tagName!==t.tagName||e.id!==t.id||e.src!==t.src||getAttr(e,"c-comp")!==getAttr(t,"c-comp")}function getAttr(e,t){return e.getAttribute?e.getAttribute(t):""}function getNodeContent(e,t){return t?"href"===t||isVanicAttr(t)||"string"!=typeof e[t]?getAttr(e,t):e[t]:e.childNodes&&0<e.childNodes.length?null:e.textContent}function diff(e,i){const l=Array.prototype.slice.call(i.childNodes),t=Array.prototype.slice.call(e.childNodes);let n=l.length-t.length;if(0<n)for(;0<n;n--)l[l.length-n].parentNode.removeChild(l[l.length-n]);t.forEach(function(t,n){if(l[n]){if(t.attributes&&t.attributes.length){let e=0;for(var r=t.attributes.length;e<r;){var o=t.attributes[e];if(o.name){var c=getNodeContent(t,o.name)||"";if(c!==(getNodeContent(l[n],o.name)||"")){let e=o.name;isVanicAttr(e)?"c-comp"!==e&&l[n].setAttribute&&l[n].setAttribute(e,c):("class"===e?e="className":"for"===e&&(e="htmlFor"),l[n][e]=c)}}e++}}if(isNotMatch(t,l[n]))l[n].parentNode.replaceChild(t.cloneNode(!0),l[n]);else{var e=getNodeContent(t);if(e&&e!==getNodeContent(l[n])&&(l[n].textContent=e),!(0<l[n].childNodes.length&&t.childNodes.length<1))return l[n].childNodes.length<1&&0<t.childNodes.length?(diff(t,e=document.createDocumentFragment()),void l[n].appendChild(e)):void(0<t.childNodes.length&&diff(t,l[n]));l[n].innerHTML=""}}else i.appendChild(t.cloneNode(!0))})}function filteredArray(e,t){const n=Object.assign([],e);return t.forEach(e=>{e=n.indexOf(e);0<=e&&n.splice(e,1)}),n}const regFindComp=/(?<=c-comp=")(.*?)(?=")/gm;let reRender,reElem,fno=[],rep={},primObject={},idx=0,hid=0,curComp,lastRes;const sto=setTimeout;function esc(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const styleToString=n=>Object.keys(n).reduce((e,t)=>e+t.split(/(?=[A-Z])/).join("-").toLowerCase()+":"+n[t]+";","");function _render(e){const t=e(),n=document.createElement("div");n.innerHTML=t,diff(n,reElem);let r=fno.length;for(;r--;){const a=fno[r];var o=a.value,c=a.key.toLowerCase();if("ref"!==c){const s=reElem.querySelector(`[c-${c}="${r}"]`);if(s)if("object"==typeof o)for(const f in o)s[c][f]=o[f];else s[c]=o}}idx=0,fno=[];var i=t.match(regFindComp)||[],l=lastRes?lastRes.match(regFindComp)||[]:i;if(lastRes=t,reRender&&i.length!==l.length){const u=filteredArray(i,l),d=filteredArray(l,i);d.forEach(e=>{e=primObject[e];e&&cleanEffect(e)}),u.forEach(e=>{e=primObject[e];if(e){const t=e["hook"];t.y.splice(0),t.e.splice(0),t.s.length&&sto(()=>t.s.forEach(e=>invoveEffect(e,!0)))}})}reRender=e}function html(e){const s=[].slice.call(arguments,1);return e.reduce((e,t,n)=>{let r=s[n-1];null!==r&&void 0!==r||(r="");n=typeof(r=Array.isArray(r)?r.join(""):r);if("function"==n||"boolean"==n||"object"==n){const l=e.match(/[^ ]+/g);var o=r,c=(l[l.length-1]||"").replace(/=|"/g,"").toLowerCase();if(!/<|>/.test(c)){var i=idx++;const a=`c-${c}="`+i;"ref"===c&&(r.ref=()=>document.querySelector(`[${a}"]`)),fno[i]={key:c,value:o},"function"!=n&&(rep[a+'"']={key:c,value:o}),e=l.slice(0,-1).join(" ")+(" "+a)}r=""}return e+String(r)+t})}function renderToString(e){return("string"==typeof e?e:e()).replace(/ c-.*="\d+"/g,e=>{var t=(e||"").split(" ");let n="";for(let e=0;e<t.length;e++){var r,o=rep[t[e]];o&&({key:o,value:r}=o,"object"==typeof r&&"ref"!==o&&(n+=` ${o}="${styleToString(r)}"`),!0===r&&(n+=" "+o))}return n})}function render(e,t){reRender=void 0,fno=[],idx=0,reElem=t,_render(e)}const comp=r=>{const o=i.hook={i:0,e:[],y:[],s:[]},c=hid++;function i(e){var t=curComp;curComp=i,o.i=0;let n=r(void 0===e?{}:e);return"string"==typeof n&&(n=(n=/<.*>/.test(n)?n:`<notag>${n}</notag>`).replace(/>/,` c-comp="${c}">`),primObject[""+c]=curComp),t&&(curComp=t),reRender?o.e.length&&sto(()=>o.e.splice(0).forEach(invoveEffect)):o.s.length&&sto(()=>{o.e.splice(0),o.s.forEach(invoveEffect)}),o.y.length&&o.y.splice(0).forEach(invoveEffect),n}return i};function useState(e){const{s:t,i:n}=curComp.hook,r=void 0===t[n]?e:t[n].state;return n>=t.length&&t.push({state:r}),curComp.hook.i++,[r,e=>{t[n].state="function"==typeof e?e(r):e,_render(reRender)}]}const hasChange=(n,e)=>!n||n.length!==e.length||e.some((e,t)=>e!==n[t]);function runCleanup(e){"function"==typeof e.clean&&e.clean()}function invoveEffect(e,t){"boolean"!=typeof t&&(runCleanup(e),e.clean=void 0),"function"==typeof e.val&&sto(()=>e.clean=e.val())}const cleanEffect=e=>{e.hook&&sto(()=>e.hook.s.forEach(runCleanup))},buildEffect=l=>(e,t)=>{if(reElem){const{i:r,s:o,e:c,y:i}=curComp.hook;t=t||o.map(e=>e.state).filter(Boolean);var n=r>=o.length;n&&(o[r]={deps:t,val:e}),(n||hasChange(o[r].deps,t))&&(l?c:i).push(o[r]),o[r].val=e,o[r].deps=t,curComp.hook.i++}},useEffect=buildEffect(!0),useLayoutEffect=buildEffect(!1);function useReducer(t,e,n){const r=useState(void 0!==n?n(e):e);return[r[0],e=>{r[1](t(r[0],e))}]}function useMemo(e,t){if(!reElem)return e();const{i:n,s:r}=curComp.hook;return t=t||r.map(e=>e.state).filter(Boolean),(n>=r.length||hasChange(r[n].deps,t))&&(r[n]={val:e(),deps:t}),curComp.hook.i++,r[n].val}const useCallback=(t,e)=>useMemo(()=>e=>t(e),e),useRef=e=>useMemo(()=>({current:e,ref:()=>e}),[]),createContext=n=>{let r;return{Provider(e,t){return r=e||n,t()},v:()=>r}},useContext=e=>e.v(),dangerHTML="dangerouslySetInnerHTML";function h(e,t){var n=[].slice.call(arguments,2);const r=[];let o="";t=t||{};for(let e=n.length;e--;)r.push("number"==typeof n[e]?String(n[e]):n[e]);if("function"==typeof e)return t.children=r.reverse(),e(t);if(e){if(o+="<"+e,t)for(var c in t)if("children"!==c){let e=t[c];var i=typeof e;if("function"==i||"boolean"==i||"object"==i){var l=e,a=c.toLowerCase();const f=idx++;"ref"===a&&(e.ref=()=>document.querySelector(`[c-${f}="${f}"]`)),fno[f]={key:a,value:l},c="c-"+a,e=f,"function"!=i&&(rep[`${c}="${e}"`]={key:a,value:l})}void 0!==e&&!1!==e&&null!==e&&c!==dangerHTML&&(o+=` ${c}="${esc(e)}"`)}o+=">"}if(-1===["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(e)){if(t[dangerHTML])o+=t[dangerHTML].__html;else for(let e=r.length;e--;){var s=Array.isArray(r[e])?r[e].join(""):r[e];"string"==typeof s&&(o+="<"!==s[0]?esc(s):s)}o+=e?`</${e}>`:""}return o}const Fragment=({children:e})=>html(null,null,e);export{Fragment,_render,comp,createContext,h,html,render,renderToString,useCallback,useContext,useEffect,useLayoutEffect,useMemo,useReducer,useRef,useState};
