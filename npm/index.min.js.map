{"version":3,"file":"index.min.js","sources":["../src/vanic/diff.js","../src/vanic/index.js"],"sourcesContent":["// CREDIT & ORIGINAL: https://gomakethings.com/dom-diffing-with-vanilla-js\n// Add diff attribute\n\nfunction getNodeType(node) {\n  if (node.nodeType === 3) return \"text\";\n  if (node.nodeType === 8) return \"comment\";\n  return node.tagName.toLowerCase();\n}\nfunction getAttr(node, attr) {\n  return node.getAttribute(attr);\n}\nfunction getNodeContent(node, attr) {\n  if (attr) {\n    if (attr === \"href\" || attr === \"van-link\") return getAttr(node, attr);\n    if (typeof node[attr] !== \"string\") return getAttr(node, attr);\n    return node[attr];\n  }\n  if (node.childNodes && node.childNodes.length > 0) return null;\n  return node.textContent;\n}\nexport function diff(template, elem) {\n  const domNodes = Array.prototype.slice.call(elem.childNodes);\n  const templateNodes = Array.prototype.slice.call(template.childNodes);\n  let count = domNodes.length - templateNodes.length;\n  if (count > 0) {\n    for (; count > 0; count--) {\n      domNodes[domNodes.length - count].parentNode.removeChild(\n        domNodes[domNodes.length - count]\n      );\n    }\n  }\n  templateNodes.forEach(function (node, index) {\n    if (!domNodes[index]) {\n      elem.appendChild(node.cloneNode(true));\n      return;\n    }\n    const type = getNodeType(node);\n    const domType = getNodeType(domNodes[index]);\n    if (type !== domType) {\n      domNodes[index].parentNode.replaceChild(\n        node.cloneNode(true),\n        domNodes[index]\n      );\n      return;\n    }\n    if (node.attributes && node.attributes.length) {\n      let i = 0;\n      const len = node.attributes.length;\n      while (i < len) {\n        const attr = node.attributes[i];\n        if (attr.name) {\n          const tpl = getNodeContent(node, attr.name) || \"\";\n          const tplDom = getNodeContent(domNodes[index], attr.name) || \"\";\n          if (tpl !== tplDom) {\n            let nm = attr.name;\n            if (nm.startsWith(\"class\")) nm = \"className\";\n            if (nm.endsWith(\"for\")) nm = \"htmlFor\";\n            domNodes[index][nm] = tpl;\n          }\n        }\n        i++;\n      }\n    }\n    const templateContent = getNodeContent(node);\n    if (\n      templateContent &&\n      templateContent !== getNodeContent(domNodes[index])\n    ) {\n      domNodes[index].textContent = templateContent;\n    }\n    if (domNodes[index].childNodes.length > 0 && node.childNodes.length < 1) {\n      domNodes[index].innerHTML = \"\";\n      return;\n    }\n    if (domNodes[index].childNodes.length < 1 && node.childNodes.length > 0) {\n      const fragment = document.createDocumentFragment();\n      diff(node, fragment);\n      domNodes[index].appendChild(fragment);\n      return;\n    }\n    if (node.childNodes.length > 0) {\n      diff(node, domNodes[index]);\n    }\n  });\n}\n","import { diff } from \"./diff.js\";\n\nlet reRender;\nlet reElem;\nlet fno = [];\nlet rep = {};\nlet idx = 0;\nlet sid = 0;\nlet hooks = [];\nlet cleans = [];\nconst warnHTML = \"dangerouslySetInnerHTML\";\nfunction esc(unsafe) {\n  return String(unsafe)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#039;\");\n}\n\nconst styleToString = (style) => {\n  return Object.keys(style).reduce(\n    (acc, key) =>\n      acc +\n      key\n        .split(/(?=[A-Z])/)\n        .join(\"-\")\n        .toLowerCase() +\n      \":\" +\n      style[key] +\n      \";\",\n    \"\"\n  );\n};\n\nfunction _render(fn) {\n  const res = fn();\n  reRender = fn;\n  const elem = document.createElement(\"div\");\n  elem.innerHTML = res;\n  diff(elem, reElem);\n  let i = fno.length;\n  while (i--) {\n    const { key, value } = fno[i];\n    const $ = document.querySelector(`[_v${(typeof value)[0]}=\"${i}\"]`);\n    if ($) {\n      if (typeof value === \"object\") {\n        for (const s in value) $[key.toLowerCase()][s] = value[s];\n      } else {\n        $[key.toLowerCase()] = value;\n      }\n    }\n  }\n  idx = 0;\n  sid = 0;\n  fno = [];\n}\n\nexport function useEffect(cb, deps) {\n  if (!reElem) return;\n  const id = sid;\n  const old = hooks[id];\n  const cc = old ? deps.some((dep, x) => !Object.is(dep, old[x])) : true;\n  hooks[id] = deps;\n  if (cleans[id]) {\n    cleans[id]();\n    cleans.splice(id, 1);\n  }\n  sid++;\n  if (cc) {\n    setTimeout(() => {\n      const fn = cb();\n      if (fn) cleans[id] = fn;\n    });\n  }\n}\n\nexport function html(ret) {\n  const subs = [].slice.call(arguments, 1);\n  return ret.reduce((a, b, c) => {\n    let val = subs[c - 1];\n    if (val === null || val === undefined) val = \"\";\n    const type = typeof val;\n    if (type === \"function\" || type === \"boolean\" || type === \"object\") {\n      const id = `${idx++}`;\n      const arr = a.split(\" \");\n      const value = val;\n      const attr = `_v${type[0]}=\"${id}`;\n      const key = (arr[arr.length - 1] || \"\").replace(/=|\"/g, \"\");\n      fno[id] = { key, value };\n      if (type !== \"function\") rep[`${attr}\"`] = { key, value };\n      a = arr.slice(0, -1).join(\" \") + ` ${attr}`;\n      val = \"\";\n    }\n    return a + String(val) + b;\n  });\n}\n\nexport function useState(val) {\n  const id = sid;\n  sid++;\n  const def = hooks[id] === undefined ? val : hooks[id];\n  return [\n    def,\n    (newVal) => {\n      hooks[id] = typeof newVal === \"function\" ? newVal(def) : newVal;\n      if (reRender) _render(reRender);\n    },\n  ];\n}\n\nexport function renderToString(fn) {\n  return (typeof fn === \"string\" ? fn : fn()).replace(\n    / _v[o|f|b]=\"\\d+\"/g,\n    (a) => {\n      const obj = rep[a.substring(1)];\n      if (obj === undefined) return \"\";\n      const { key, value } = obj;\n      const type = typeof value;\n      if (type === \"object\") return ` ${key}=\"${styleToString(value)}\"`;\n      if (value === true) return ` ${key}`;\n      return \"\";\n    }\n  );\n}\n\nexport function render(fn, elem) {\n  reRender = undefined;\n  reElem = undefined;\n  fno = [];\n  idx = 0;\n  sid = 0;\n  hooks = [];\n  cleans = [];\n  reElem = elem;\n  _render(fn);\n}\n\nexport function h(tag, attr) {\n  const args = [].slice.call(arguments, 2);\n  const arr = [];\n  let str = \"\";\n  attr = attr || {};\n  for (let i = args.length; i--; ) {\n    arr.push(typeof args[i] === \"number\" ? String(args[i]) : args[i]);\n  }\n  if (typeof tag === \"function\") {\n    attr.children = arr.reverse();\n    return tag(attr);\n  }\n  if (tag) {\n    str += `<${tag}`;\n    if (attr) {\n      for (let k in attr) {\n        let val = attr[k];\n        const type = typeof val;\n        if (type === \"function\" || type === \"boolean\" || type === \"object\") {\n          const id = `${idx++}`;\n          const value = val;\n          const key = k;\n          fno[id] = { key, value };\n          k = `_v${type[0]}`;\n          val = id;\n          if (type !== \"function\") rep[`${k}=\"${val}\"`] = { key, value };\n        }\n        if (\n          val !== undefined &&\n          val !== false &&\n          val !== null &&\n          k !== warnHTML &&\n          k !== \"\"\n        ) {\n          str += ` ${k}=\"${esc(val)}\"`;\n        }\n      }\n    }\n    str += \">\";\n  }\n  if (\n    [\n      \"area\",\n      \"base\",\n      \"br\",\n      \"col\",\n      \"command\",\n      \"embed\",\n      \"hr\",\n      \"img\",\n      \"input\",\n      \"keygen\",\n      \"link\",\n      \"meta\",\n      \"param\",\n      \"source\",\n      \"track\",\n      \"wbr\",\n    ].indexOf(tag) === -1\n  ) {\n    if (attr[warnHTML]) {\n      str += attr[warnHTML].__html;\n    } else {\n      for (let i = arr.length; i--; ) {\n        const child = Array.isArray(arr[i]) ? arr[i].join(\"\") : arr[i];\n        str += child[0] !== \"<\" ? esc(child) : child;\n      }\n    }\n    str += tag ? `</${tag}>` : \"\";\n  }\n  return str;\n}\n\nexport const Fragment = ({ children }) => h(\"\", null, children);\n"],"names":["getNodeType","node","nodeType","tagName","toLowerCase","getNodeContent","attr","getAttribute","childNodes","length","textContent","reRender","reElem","fno","idx","sid","hooks","cleans","_render","fn","res","elem","document","createElement","i","innerHTML","diff","template","domNodes","Array","prototype","slice","call","templateNodes","count","parentNode","removeChild","forEach","index","replaceChild","cloneNode","attributes","len","tpl","name","nm","startsWith","endsWith","templateContent","fragment","createDocumentFragment","appendChild","key","value","$","querySelector","concat","s","ret","subs","arguments","reduce","a","b","c","id","arr","val","type","split","replace","join","String","undefined","cb","deps","old","cc","some","dep","x","Object","is","splice","setTimeout","def","newVal"],"mappings":"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"}