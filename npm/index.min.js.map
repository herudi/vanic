{"version":3,"file":"index.min.js","sources":["../src/vanic/diff.js","../src/vanic/index.js"],"sourcesContent":["// CREDIT & ORIGINAL: https://gomakethings.com/dom-diffing-with-vanilla-js\n// Add diff attribute\nfunction getNodeType(node) {\n  if (node.nodeType === 3) return \"text\";\n  if (node.nodeType === 8) return \"comment\";\n  return node.tagName.toLowerCase();\n}\nfunction getAttr(node, attr) {\n  return node.getAttribute(attr);\n}\nfunction getNodeContent(node, attr) {\n  if (attr) {\n    if (\n      attr === \"href\" ||\n      attr === \"van-link\" ||\n      (attr[0] === \"c\" && attr[1] === \"-\")\n    )\n      return getAttr(node, attr);\n    if (typeof node[attr] !== \"string\") return getAttr(node, attr);\n    return node[attr];\n  }\n  if (node.childNodes && node.childNodes.length > 0) return null;\n  return node.textContent;\n}\nexport function diff(template, elem) {\n  const domNodes = Array.prototype.slice.call(elem.childNodes);\n  const templateNodes = Array.prototype.slice.call(template.childNodes);\n  let count = domNodes.length - templateNodes.length;\n  if (count > 0) {\n    for (; count > 0; count--) {\n      domNodes[domNodes.length - count].parentNode.removeChild(\n        domNodes[domNodes.length - count]\n      );\n    }\n  }\n  templateNodes.forEach(function (node, index) {\n    if (!domNodes[index]) {\n      elem.appendChild(node.cloneNode(true));\n      return;\n    }\n    const type = getNodeType(node);\n    const domType = getNodeType(domNodes[index]);\n    if (type !== domType) {\n      domNodes[index].parentNode.replaceChild(\n        node.cloneNode(true),\n        domNodes[index]\n      );\n      return;\n    }\n    if (node.attributes && node.attributes.length) {\n      let i = 0;\n      const len = node.attributes.length;\n      while (i < len) {\n        const attr = node.attributes[i];\n        if (attr.name) {\n          const tpl = getNodeContent(node, attr.name) || \"\";\n          const tplDom = getNodeContent(domNodes[index], attr.name) || \"\";\n          if (tpl !== tplDom) {\n            let nm = attr.name;\n            if (nm[0] === \"c\" && nm[1] === \"-\") {\n              domNodes[index].setAttribute(nm, tpl);\n            } else {\n              if (nm === \"class\") nm = \"className\";\n              else if (nm === \"for\") nm = \"htmlFor\";\n              domNodes[index][nm] = tpl;\n            }\n          }\n        }\n        i++;\n      }\n    }\n    const templateContent = getNodeContent(node);\n    if (\n      templateContent &&\n      templateContent !== getNodeContent(domNodes[index])\n    ) {\n      domNodes[index].textContent = templateContent;\n    }\n    if (domNodes[index].childNodes.length > 0 && node.childNodes.length < 1) {\n      domNodes[index].innerHTML = \"\";\n      return;\n    }\n    if (domNodes[index].childNodes.length < 1 && node.childNodes.length > 0) {\n      const fragment = document.createDocumentFragment();\n      diff(node, fragment);\n      domNodes[index].appendChild(fragment);\n      return;\n    }\n    if (node.childNodes.length > 0) {\n      diff(node, domNodes[index]);\n    }\n  });\n}\n","import { diff } from \"./diff.js\";\n\nlet reRender;\nlet reElem;\nlet fno = [];\nlet rep = {};\nlet idx = 0;\n\n// hook var\nlet hid = 0;\nlet states = [];\nlet cleans = [];\nlet mems = [];\n\nfunction esc(unsafe) {\n  return String(unsafe)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#039;\");\n}\n\nconst styleToString = (style) => {\n  return Object.keys(style).reduce(\n    (acc, key) =>\n      acc +\n      key\n        .split(/(?=[A-Z])/)\n        .join(\"-\")\n        .toLowerCase() +\n      \":\" +\n      style[key] +\n      \";\",\n    \"\"\n  );\n};\n\nexport function _render(fn) {\n  const res = fn();\n  reRender = fn;\n  const elem = document.createElement(\"div\");\n  elem.innerHTML = res;\n  diff(elem, reElem);\n  let i = fno.length;\n  while (i--) {\n    const obj = fno[i];\n    const value = obj.value;\n    const key = obj.key.toLowerCase();\n    if (key !== \"ref\") {\n      const $ = document.querySelector(`[c-${i}=\"${i}\"]`);\n      if ($) {\n        if (typeof value === \"object\") {\n          for (const s in value) $[key][s] = value[s];\n        } else {\n          $[key] = value;\n        }\n      }\n    }\n  }\n  hid = 0;\n  idx = 0;\n  fno = [];\n}\n\nexport function html(ret) {\n  const subs = [].slice.call(arguments, 1);\n  return ret.reduce((start, end, no) => {\n    let val = subs[no - 1];\n    if (val === null || val === undefined) val = \"\";\n    if (Array.isArray(val)) val = val.join(\"\");\n    const type = typeof val;\n    if (type === \"function\" || type === \"boolean\" || type === \"object\") {\n      const arr = start.match(/[^ ]+/g);\n      const value = val;\n      const key = (arr[arr.length - 1] || \"\").replace(/=|\"/g, \"\").toLowerCase();\n      const id = idx++;\n      const attr = `c-${id}=\"${id}`;\n      if (key === \"ref\") {\n        val.ref = () => document.querySelector(`[${attr}\"]`);\n      }\n      fno[id] = { key, value };\n      if (type !== \"function\") rep[`${attr}\"`] = { key, value };\n      start = arr.slice(0, -1).join(\" \") + ` ${attr}`;\n      val = \"\";\n    }\n    return start + String(val) + end;\n  });\n}\n\nexport function renderToString(fn) {\n  return (typeof fn === \"string\" ? fn : fn()).replace(/ c-.*=\"\\d+\"/g, (a) => {\n    const arr = (a || \"\").split(\" \");\n    let str = \"\";\n    for (let i = 0; i < arr.length; i++) {\n      const ret = rep[arr[i]];\n      if (ret) {\n        const { key, value } = ret;\n        const type = typeof value;\n        if (type === \"object\" && key !== \"ref\") {\n          str += ` ${key}=\"${styleToString(value)}\"`;\n        }\n        if (value === true) str += ` ${key}`;\n      }\n    }\n    return str;\n  });\n}\n\nexport function render(fn, elem) {\n  reRender = undefined;\n  fno = [];\n  idx = 0;\n  reElem = elem;\n  hid = 0;\n  states = [];\n  cleans = [];\n  mems = [];\n  _render(fn);\n}\n\nfunction hasChange(id, deps) {\n  const hook = states[id];\n  const cc = hook ? deps.some((dep, x) => !Object.is(dep, hook[x])) : true;\n  states[id] = deps;\n  return cc;\n}\n\n// useState\nexport function useState(val) {\n  const id = hid;\n  hid++;\n  const def = states[id] === undefined ? val : states[id];\n  return [\n    def,\n    (newVal) => {\n      states[id] = typeof newVal === \"function\" ? newVal(def) : newVal;\n      _render(reRender);\n    },\n  ];\n}\n\n// useEffect\nexport function useEffect(cb, deps) {\n  if (!reElem) return;\n  const id = hid;\n  const cc = hasChange(id, deps);\n  if (cleans[id]) {\n    cleans[id]();\n    cleans.splice(id, 1);\n  }\n  hid++;\n  if (cc) {\n    setTimeout(() => {\n      const fn = cb();\n      if (fn) cleans[id] = fn;\n    });\n  }\n}\n\nexport const useLayoutEffect = useEffect;\n\n// useReducer\nexport function useReducer(reducer, init, initLazy) {\n  const arr = useState(initLazy !== undefined ? initLazy(init) : init);\n  return [\n    arr[0],\n    (action) => {\n      arr[1](reducer(arr[0], action));\n    },\n  ];\n}\n\n// useMemo\nexport function useMemo(fn, deps) {\n  if (!reElem) return fn();\n  const id = hid;\n  const cc = hasChange(id, deps);\n  if (cc) mems[id] = fn();\n  hid++;\n  return mems[id];\n}\n\n// useCallback\nexport const useCallback = (cb, deps) => useMemo(() => (p) => cb(p), deps);\n\n// useRef\nexport const useRef = (current) =>\n  useMemo(() => ({ current, ref: () => current }), []);\n\n// createContext\nexport const createContext = (init) => {\n  let value;\n  return {\n    Provider(newVal, fn) {\n      value = newVal || init;\n      return fn();\n    },\n    v: () => value,\n  };\n};\n\n// useContext\nexport const useContext = (c) => {\n  return c.v();\n};\n\n// CREDIT & ORIGINAL https://github.com/developit/vhtml\n// Add event, ref and style as object.\nconst dangerHTML = \"dangerouslySetInnerHTML\";\nexport function h(tag, attr) {\n  const args = [].slice.call(arguments, 2);\n  const arr = [];\n  let str = \"\";\n  attr = attr || {};\n  for (let i = args.length; i--; ) {\n    arr.push(typeof args[i] === \"number\" ? String(args[i]) : args[i]);\n  }\n  if (typeof tag === \"function\") {\n    attr.children = arr.reverse();\n    return tag(attr);\n  }\n  if (tag) {\n    str += `<${tag}`;\n    if (attr) {\n      for (let k in attr) {\n        let val = attr[k];\n        const type = typeof val;\n        if (type === \"function\" || type === \"boolean\" || type === \"object\") {\n          const id = idx++;\n          const value = val;\n          const key = k.toLowerCase();\n          if (key === \"ref\") {\n            val.ref = () => document.querySelector(`[c-${id}=\"${id}\"]`);\n          }\n          fno[id] = { key, value };\n          k = `c-${id}`;\n          val = id;\n          if (type !== \"function\") rep[`${k}=\"${val}\"`] = { key, value };\n        }\n        if (\n          val !== undefined &&\n          val !== false &&\n          val !== null &&\n          k !== dangerHTML\n        ) {\n          str += ` ${k}=\"${esc(val)}\"`;\n        }\n      }\n    }\n    str += \">\";\n  }\n  if (\n    [\n      \"area\",\n      \"base\",\n      \"br\",\n      \"col\",\n      \"command\",\n      \"embed\",\n      \"hr\",\n      \"img\",\n      \"input\",\n      \"keygen\",\n      \"link\",\n      \"meta\",\n      \"param\",\n      \"source\",\n      \"track\",\n      \"wbr\",\n    ].indexOf(tag) === -1\n  ) {\n    if (attr[dangerHTML]) {\n      str += attr[dangerHTML].__html;\n    } else {\n      for (let i = arr.length; i--; ) {\n        const child = Array.isArray(arr[i]) ? arr[i].join(\"\") : arr[i];\n        if (typeof child === \"string\") {\n          str += child[0] !== \"<\" ? esc(child) : child;\n        }\n      }\n    }\n    str += tag ? `</${tag}>` : \"\";\n  }\n  return str;\n}\n\nexport const Fragment = ({ children }) => h(null, null, children);\n"],"names":["getNodeType","node","nodeType","tagName","toLowerCase","getNodeContent","attr","getAttribute","childNodes","length","textContent","reRender","reElem","fno","idx","hid","states","cleans","mems","_render","fn","res","elem","document","createElement","i","innerHTML","diff","template","domNodes","Array","prototype","slice","call","templateNodes","count","parentNode","removeChild","forEach","index","replaceChild","cloneNode","attributes","len","tpl","name","nm","setAttribute","templateContent","fragment","createDocumentFragment","appendChild","obj","value","key","$","querySelector","s","hasChange","id","deps","hook","cc","some","dep","x","Object","is","useState","val","def","undefined","newVal","useEffect","cb","splice","setTimeout","useLayoutEffect","useMemo","init","Provider","v","ret","subs","arguments","reduce","start","end","no","arr","type","isArray","join","match","replace","ref","String","p","c","reducer","initLazy","action","current"],"mappings":"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"}