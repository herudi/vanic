{"version":3,"file":"index.min.js","sources":["../src/vanic/diff.js","../src/vanic/index.js"],"sourcesContent":["// CREDIT & ORIGINAL: https://gomakethings.com/dom-diffing-with-vanilla-js\n// Add diff attribute\n\nfunction getNodeType(node) {\n  if (node.nodeType === 3) return \"text\";\n  if (node.nodeType === 8) return \"comment\";\n  return node.tagName.toLowerCase();\n}\nfunction getAttr(node, attr) {\n  return node.getAttribute(attr);\n}\nfunction getNodeContent(node, attr) {\n  if (attr) {\n    if (attr === \"href\" || attr === \"van-link\") return getAttr(node, attr);\n    if (typeof node[attr] !== \"string\") return getAttr(node, attr);\n    return node[attr];\n  }\n  if (node.childNodes && node.childNodes.length > 0) return null;\n  return node.textContent;\n}\nexport function diff(template, elem) {\n  const domNodes = Array.prototype.slice.call(elem.childNodes);\n  const templateNodes = Array.prototype.slice.call(template.childNodes);\n  let count = domNodes.length - templateNodes.length;\n  if (count > 0) {\n    for (; count > 0; count--) {\n      domNodes[domNodes.length - count].parentNode.removeChild(\n        domNodes[domNodes.length - count]\n      );\n    }\n  }\n  templateNodes.forEach(function (node, index) {\n    if (!domNodes[index]) {\n      elem.appendChild(node.cloneNode(true));\n      return;\n    }\n    const type = getNodeType(node);\n    const domType = getNodeType(domNodes[index]);\n    if (type !== domType) {\n      domNodes[index].parentNode.replaceChild(\n        node.cloneNode(true),\n        domNodes[index]\n      );\n      return;\n    }\n    if (node.attributes && node.attributes.length) {\n      let i = 0;\n      const len = node.attributes.length;\n      while (i < len) {\n        const attr = node.attributes[i];\n        if (attr.name) {\n          const tpl = getNodeContent(node, attr.name) || \"\";\n          const tplDom = getNodeContent(domNodes[index], attr.name) || \"\";\n          if (tpl !== tplDom) {\n            let nm = attr.name;\n            if (nm.startsWith(\"class\")) nm = \"className\";\n            if (nm.endsWith(\"for\")) nm = \"htmlFor\";\n            domNodes[index][nm] = tpl;\n          }\n        }\n        i++;\n      }\n    }\n    const templateContent = getNodeContent(node);\n    if (\n      templateContent &&\n      templateContent !== getNodeContent(domNodes[index])\n    ) {\n      domNodes[index].textContent = templateContent;\n    }\n    if (domNodes[index].childNodes.length > 0 && node.childNodes.length < 1) {\n      domNodes[index].innerHTML = \"\";\n      return;\n    }\n    if (domNodes[index].childNodes.length < 1 && node.childNodes.length > 0) {\n      const fragment = document.createDocumentFragment();\n      diff(node, fragment);\n      domNodes[index].appendChild(fragment);\n      return;\n    }\n    if (node.childNodes.length > 0) {\n      diff(node, domNodes[index]);\n    }\n  });\n}\n","import { diff } from \"./diff.js\";\n\nlet reRender;\nlet reElem;\nlet fno = {};\nlet rep = {};\nlet idx = 0;\nlet sid = 0;\nlet hooks = [];\nlet cleans = [];\n\nconst styleToString = (style) => {\n  return Object.keys(style).reduce(\n    (acc, key) =>\n      acc +\n      key\n        .split(/(?=[A-Z])/)\n        .join(\"-\")\n        .toLowerCase() +\n      \":\" +\n      style[key] +\n      \";\",\n    \"\"\n  );\n};\n\nfunction _render(fn) {\n  const res = fn();\n  reRender = fn;\n  const elem = document.createElement(\"div\");\n  elem.innerHTML = res;\n  diff(elem, reElem);\n  for (const k in fno) {\n    const name = fno[k];\n    for (const l in name) {\n      const act = name[l];\n      const $ = document.querySelector(`[_v${(typeof act)[0]}=\"${l}\"]`);\n      if (typeof act === \"object\") {\n        for (const s in act) $[k.toLowerCase()][s] = act[s];\n      } else $[k.toLowerCase()] = act;\n    }\n  }\n  idx = 0;\n  sid = 0;\n  fno = {};\n  return res;\n}\n\nexport function useEffect(cb, deps) {\n  if (!reElem) return;\n  const id = sid;\n  const old = hooks[id];\n  const cc = old ? deps.some((dep, x) => !Object.is(dep, old[x])) : true;\n  hooks[id] = deps;\n  if (cleans[id]) {\n    cleans[id]();\n    cleans.splice(id, 1);\n  }\n  sid++;\n  if (cc) {\n    setTimeout(() => {\n      const fn = cb();\n      if (fn) cleans[id] = fn;\n    });\n  }\n}\n\nexport function html(ret) {\n  const subs = [].slice.call(arguments, 1);\n  return ret.reduce((a, b, c) => {\n    let val = subs[c - 1];\n    if (val === null || val === undefined) val = \"\";\n    const type = typeof val;\n    if (type === \"function\" || type === \"boolean\" || type === \"object\") {\n      const id = `${idx++}`;\n      const arr = a.split(\" \");\n      const value = val;\n      const attr = `_v${type[0]}=\"${id}`;\n      const name = (arr[arr.length - 1] || \"\").replace(/=|\"/g, \"\");\n      fno[name] = fno[name] || {};\n      fno[name][id] = value;\n      if (type !== \"function\") rep[`${attr}\"`] = [name, value];\n      a = arr.slice(0, -1).join(\" \") + ` ${attr}`;\n      val = \"\";\n    }\n    return a + String(val) + b;\n  });\n}\n\nexport function useState(val) {\n  const id = sid;\n  sid++;\n  return [\n    hooks[id] === undefined ? val : hooks[id],\n    (newVal) => {\n      hooks[id] = newVal;\n      if (reRender) _render(reRender);\n    },\n  ];\n}\n\nexport function render(fn, elem) {\n  reRender = undefined;\n  reElem = undefined;\n  fno = {};\n  idx = 0;\n  sid = 0;\n  hooks = [];\n  cleans = [];\n  if (!elem) {\n    return fn().replace(/ _v[o|f|b]=\"\\d+\"/g, (a) => {\n      const arr = rep[a.substring(1)];\n      if (arr === undefined) return \"\";\n      const type = typeof arr[1];\n      if (type === \"object\") return ` ${arr[0]}=\"${styleToString(arr[1])}\"`;\n      if (type === \"boolean\" && arr[1] === true) return ` ${arr[0]}`;\n      return \"\";\n    });\n  }\n  reElem = elem;\n  return _render(fn);\n}\n\n// CREDIT & ORIGINAL https://github.com/developit/vhtml\n// Add event onclick, onchange etc. and support style object.\nconst emptyTags = [\n  \"area\",\n  \"base\",\n  \"br\",\n  \"col\",\n  \"command\",\n  \"embed\",\n  \"hr\",\n  \"img\",\n  \"input\",\n  \"keygen\",\n  \"link\",\n  \"meta\",\n  \"param\",\n  \"source\",\n  \"track\",\n  \"wbr\",\n];\nconst esc = (str) => String(str).replace(/[&<>\"']/g, (s) => `&${map[s]};`);\nconst map = { \"&\": \"amp\", \"<\": \"lt\", \">\": \"gt\", '\"': \"quot\", \"'\": \"apos\" };\nconst setInnerHTMLAttr = \"dangerouslySetInnerHTML\";\nconst DOMAttributeNames = {\n  className: \"class\",\n  htmlFor: \"for\",\n};\nconst sanitized = {};\nexport function h(name, attrs) {\n  const stack = [];\n  let s = \"\";\n  attrs = attrs || {};\n  for (let i = arguments.length; i-- > 2; ) {\n    const arg = arguments[i];\n    stack.push(typeof arg === \"number\" ? String(arg) : arg);\n  }\n  if (typeof name === \"function\") {\n    attrs.children = stack.reverse();\n    return name(attrs);\n  }\n  if (name) {\n    s += \"<\" + name;\n    if (attrs) {\n      for (let i in attrs) {\n        let val = attrs[i];\n        const type = typeof val;\n        if (type === \"function\" || type === \"boolean\" || type === \"object\") {\n          const id = `${idx++}`;\n          const value = val;\n          const name = i;\n          fno[name] = fno[name] || {};\n          fno[name][id] = value;\n          i = `_v${type[0]}`;\n          val = id;\n          if (type !== \"function\") rep[`${i}=\"${val}\"`] = [name, value];\n        }\n        if (\n          val !== false &&\n          val !== null &&\n          val !== undefined &&\n          i !== setInnerHTMLAttr &&\n          i !== \"\"\n        ) {\n          s += ` ${DOMAttributeNames[i] ? DOMAttributeNames[i] : esc(i)}=\"${esc(\n            val\n          )}\"`;\n        }\n      }\n    }\n    s += \">\";\n  }\n  if (emptyTags.indexOf(name) === -1) {\n    if (attrs[setInnerHTMLAttr]) {\n      s += attrs[setInnerHTMLAttr].__html;\n    } else {\n      while (stack.length) {\n        const child = stack.pop();\n        if (child) {\n          if (child.pop) {\n            for (let i = child.length; i--; ) stack.push(child[i]);\n          } else {\n            s += sanitized[child] === true ? child : esc(child);\n          }\n        }\n      }\n    }\n    s += name ? `</${name}>` : \"\";\n  }\n  sanitized[s] = true;\n  return s;\n}\n\nexport const Fragment = ({ children }) => h(\"\", null, children);\n"],"names":["getNodeType","node","nodeType","tagName","toLowerCase","getNodeContent","attr","getAttribute","childNodes","length","textContent","reRender","reElem","fno","rep","idx","sid","hooks","cleans","_render","fn","k","res","elem","document","createElement","innerHTML","diff","template","domNodes","Array","prototype","slice","call","templateNodes","count","parentNode","removeChild","forEach","index","replaceChild","cloneNode","attributes","i","len","tpl","name","nm","startsWith","endsWith","templateContent","fragment","createDocumentFragment","appendChild","l","act","$","querySelector","concat","s","ret","subs","arguments","reduce","a","b","c","id","arr","value","val","type","split","replace","join","String","substring","undefined","style","Object","keys","acc","key","cb","deps","old","cc","some","dep","x","is","splice","setTimeout","newVal"],"mappings":"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"}